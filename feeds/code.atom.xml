<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Das Keyboard Shredder - code</title><link href="https://www.lyh.me/" rel="alternate"></link><link href="/feeds/code.atom.xml" rel="self"></link><id>https://www.lyh.me/</id><updated>2017-03-28T12:23:00-04:00</updated><entry><title>For comprehensions</title><link href="https://www.lyh.me/for-comprehensions.html" rel="alternate"></link><published>2017-03-28T12:23:00-04:00</published><updated>2017-03-28T12:23:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2017-03-28:/for-comprehensions.html</id><summary type="html">&lt;p&gt;I made these &lt;a href="/slides/for-yield.html"&gt;slides&lt;/a&gt; on for comprehension a while ago but forgot to post them but here you&amp;nbsp;go.&lt;/p&gt;
&lt;iframe src="/slides/for-yield.html" width="800" height="450"&gt;&lt;/iframe&gt;</summary><content type="html">&lt;p&gt;I made these &lt;a href="/slides/for-yield.html"&gt;slides&lt;/a&gt; on for comprehension a while ago but forgot to post them but here you&amp;nbsp;go.&lt;/p&gt;
&lt;iframe src="/slides/for-yield.html" width="800" height="450"&gt;&lt;/iframe&gt;</content><category term="scala"></category><category term="fp"></category></entry><entry><title>Joins</title><link href="https://www.lyh.me/joins.html" rel="alternate"></link><published>2017-03-28T02:38:00-04:00</published><updated>2017-03-28T02:38:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2017-03-28:/joins.html</id><summary type="html">&lt;p&gt;We recently started teaching &lt;a href="https://github.com/spotify/scio"&gt;Scio&lt;/a&gt; at Spotify&amp;#8217;s internal data university. In this new iteration we completely moved from Hadoop, Map/Reduce and &lt;span class="caps"&gt;HDFS&lt;/span&gt; over to Google Cloud and Dataflow. For me as a teacher I find it hard to explain how join works without going into some low level …&lt;/p&gt;</summary><content type="html">&lt;p&gt;We recently started teaching &lt;a href="https://github.com/spotify/scio"&gt;Scio&lt;/a&gt; at Spotify&amp;#8217;s internal data university. In this new iteration we completely moved from Hadoop, Map/Reduce and &lt;span class="caps"&gt;HDFS&lt;/span&gt; over to Google Cloud and Dataflow. For me as a teacher I find it hard to explain how join works without going into some low level details. So I made these &lt;a href="/slides/joins.html"&gt;slides&lt;/a&gt; and hope they clearify&amp;nbsp;things.&lt;/p&gt;
&lt;iframe src="/slides/joins.html" width="800" height="450"&gt;&lt;/iframe&gt;</content><category term="scala"></category><category term="fp"></category><category term="data"></category></entry><entry><title>Scio at Scala by the Bay</title><link href="https://www.lyh.me/scio-at-scala-by-the-bay.html" rel="alternate"></link><published>2016-11-14T13:04:00-05:00</published><updated>2016-11-14T13:04:00-05:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2016-11-14:/scio-at-scala-by-the-bay.html</id><summary type="html">&lt;p&gt;It&amp;#8217;s been 7 months since we first announced &lt;a href="https://github.com/spotify/scio"&gt;Scio&lt;/a&gt; at &lt;a href="https://cloudplatformonline.com/NEXT2016.html"&gt;&lt;span class="caps"&gt;GCPNEXT16&lt;/span&gt;&lt;/a&gt;. There&amp;#8217;re now dozens of internal teams and a couple of other companies using Scio to run hundreds of pipelines on a daily basis. Within &lt;a href="https://www.spotify.com/"&gt;Spotify&lt;/a&gt;, Scio is now the prefered framework for building new data pipelines on …&lt;/p&gt;</summary><content type="html">&lt;p&gt;It&amp;#8217;s been 7 months since we first announced &lt;a href="https://github.com/spotify/scio"&gt;Scio&lt;/a&gt; at &lt;a href="https://cloudplatformonline.com/NEXT2016.html"&gt;&lt;span class="caps"&gt;GCPNEXT16&lt;/span&gt;&lt;/a&gt;. There&amp;#8217;re now dozens of internal teams and a couple of other companies using Scio to run hundreds of pipelines on a daily basis. Within &lt;a href="https://www.spotify.com/"&gt;Spotify&lt;/a&gt;, Scio is now the prefered framework for building new data pipelines on &lt;a href="http://cloud.google.com/"&gt;Google Cloud Platform&lt;/a&gt;. We&amp;#8217;ve also made 19 released and added tons of features and improvements. Below is a list of some notable&amp;nbsp;ones.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Interactive &lt;span class="caps"&gt;REPL&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Type safe BigQuery macro improvements and &lt;a href="https://github.com/spotify/scio-idea-plugin"&gt;Scio-&lt;span class="caps"&gt;IDEA&lt;/span&gt;-plugin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;BigQuery &lt;a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/"&gt;standard &lt;span class="caps"&gt;SQL&lt;/span&gt; 2011 syntax&lt;/a&gt;&amp;nbsp;support&lt;/li&gt;
&lt;li&gt;&lt;span class="caps"&gt;HDFS&lt;/span&gt; source and&amp;nbsp;sink&lt;/li&gt;
&lt;li&gt;Avro file compression&amp;nbsp;support&lt;/li&gt;
&lt;li&gt;Bigtable multi-table sink and utility for cluster&amp;nbsp;scaling&lt;/li&gt;
&lt;li&gt;Protobuf file support and usability&amp;nbsp;improvements&lt;/li&gt;
&lt;li&gt;Accumulator usability&amp;nbsp;improvements&lt;/li&gt;
&lt;li&gt;End-to-end testing utilities and matchers&amp;nbsp;improvements&lt;/li&gt;
&lt;li&gt;Join performance improvements and skewed&amp;nbsp;join&lt;/li&gt;
&lt;li&gt;Metrics interface and&amp;nbsp;enhancements&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I talked about Scio at &lt;a href="http://scala.bythebay.io/"&gt;Scala by the Bay&lt;/a&gt; last week and here are the&amp;nbsp;slides.&lt;/p&gt;
&lt;iframe src="//www.slideshare.net/slideshow/embed_code/key/13tC6anQaZpNE8" width="800" height="490" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen&gt; &lt;/iframe&gt;

&lt;p&gt;&lt;div style="margin-bottom:5px"&gt; &lt;strong&gt; &lt;a href="//www.slideshare.net/sinisalyh/scio-a-scala-api-for-google-cloud-dataflow-apache-beam" title="Scio - A Scala API for Google Cloud Dataflow &amp;amp; Apache Beam" target="_blank"&gt;Scio - A Scala &lt;span class="caps"&gt;API&lt;/span&gt; for Google Cloud Dataflow &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; Apache Beam&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a target="_blank" href="//www.slideshare.net/sinisalyh"&gt;Neville Li&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;&lt;/p&gt;</content><category term="data"></category><category term="scala"></category><category term="scio"></category></entry><entry><title>Semigroups</title><link href="https://www.lyh.me/semigroups.html" rel="alternate"></link><published>2016-09-21T19:22:00-04:00</published><updated>2016-09-21T19:22:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2016-09-21:/semigroups.html</id><summary type="html">&lt;p&gt;It&amp;#8217;s been a while since my last post. Both &lt;a href="https://github.com/spotify/scio"&gt;Scio&lt;/a&gt; and Scala have been picking up a lot of momentum within &lt;a href="https://www.spotify.com"&gt;Spotify&lt;/a&gt; and a lot of people are starting to leveraging the power of &lt;a href="https://github.com/twitter/algebird"&gt;Algebird&lt;/a&gt;. So here&amp;#8217;s another mini-talk on &lt;a href="/slides/semigroups.html"&gt;Semigroups&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src="/slides/semigroups.html" width="800" height="450"&gt;&lt;/iframe&gt;</summary><content type="html">&lt;p&gt;It&amp;#8217;s been a while since my last post. Both &lt;a href="https://github.com/spotify/scio"&gt;Scio&lt;/a&gt; and Scala have been picking up a lot of momentum within &lt;a href="https://www.spotify.com"&gt;Spotify&lt;/a&gt; and a lot of people are starting to leveraging the power of &lt;a href="https://github.com/twitter/algebird"&gt;Algebird&lt;/a&gt;. So here&amp;#8217;s another mini-talk on &lt;a href="/slides/semigroups.html"&gt;Semigroups&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src="/slides/semigroups.html" width="800" height="450"&gt;&lt;/iframe&gt;</content><category term="scala"></category><category term="fp"></category><category term="scio"></category><category term="data"></category></entry><entry><title>Scio, a Scala API for Google Cloud Dataflow</title><link href="https://www.lyh.me/scio-a-scala-api-for-google-cloud-dataflow.html" rel="alternate"></link><published>2016-04-21T12:47:00-04:00</published><updated>2016-04-21T12:47:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2016-04-21:/scio-a-scala-api-for-google-cloud-dataflow.html</id><summary type="html">&lt;p&gt;We recently open sourced &lt;a href="https://github.com/spotify/scio"&gt;Scio&lt;/a&gt;, a Scala &lt;span class="caps"&gt;API&lt;/span&gt; for &lt;a href="https://github.com/GoogleCloudPlatform/DataflowJavaSDK"&gt;Google Cloud Dataflow&lt;/a&gt;. Here are the slides of our talk at &lt;a href="https://cloudplatformonline.com/NEXT2016.html"&gt;&lt;span class="caps"&gt;GCPNEXT16&lt;/span&gt;&lt;/a&gt; a few weeks&amp;nbsp;ago.&lt;/p&gt;
&lt;iframe src="//www.slideshare.net/slideshow/embed_code/key/rRPUB4cSAvgF8M" width="800" height="490" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen&gt; &lt;/iframe&gt;

&lt;p&gt;&lt;div style="margin-bottom:5px"&gt; &lt;strong&gt; &lt;a href="//www.slideshare.net/sinisalyh/from-stream-to-recommendation-using-apache-beam-with-cloud-pubsub-and-cloud-dataflow" title="From stream to recommendation using apache beam with cloud pubsub and cloud dataflow" target="_blank"&gt;From stream to recommendation using apache beam with cloud pubsub and cloud dataflow&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href="//www.slideshare.net/sinisalyh" target="_blank"&gt;Neville Li&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;&lt;/p&gt;
&lt;p&gt;The first half of the talk covers our experiments …&lt;/p&gt;</summary><content type="html">&lt;p&gt;We recently open sourced &lt;a href="https://github.com/spotify/scio"&gt;Scio&lt;/a&gt;, a Scala &lt;span class="caps"&gt;API&lt;/span&gt; for &lt;a href="https://github.com/GoogleCloudPlatform/DataflowJavaSDK"&gt;Google Cloud Dataflow&lt;/a&gt;. Here are the slides of our talk at &lt;a href="https://cloudplatformonline.com/NEXT2016.html"&gt;&lt;span class="caps"&gt;GCPNEXT16&lt;/span&gt;&lt;/a&gt; a few weeks&amp;nbsp;ago.&lt;/p&gt;
&lt;iframe src="//www.slideshare.net/slideshow/embed_code/key/rRPUB4cSAvgF8M" width="800" height="490" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen&gt; &lt;/iframe&gt;

&lt;p&gt;&lt;div style="margin-bottom:5px"&gt; &lt;strong&gt; &lt;a href="//www.slideshare.net/sinisalyh/from-stream-to-recommendation-using-apache-beam-with-cloud-pubsub-and-cloud-dataflow" title="From stream to recommendation using apache beam with cloud pubsub and cloud dataflow" target="_blank"&gt;From stream to recommendation using apache beam with cloud pubsub and cloud dataflow&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href="//www.slideshare.net/sinisalyh" target="_blank"&gt;Neville Li&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;&lt;/p&gt;
&lt;p&gt;The first half of the talk covers our experiments with Dataflow and Pub/Sub for streaming application while the second half covers Scio and BigQuery for batch analysis and machine&amp;nbsp;learning.&lt;/p&gt;</content><category term="data"></category><category term="scala"></category><category term="scio"></category></entry><entry><title>Scala Data Pipelines @ Spotify</title><link href="https://www.lyh.me/scala-data-pipelines-spotify.html" rel="alternate"></link><published>2015-11-10T11:26:00-05:00</published><updated>2015-11-10T11:26:00-05:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2015-11-10:/scala-data-pipelines-spotify.html</id><summary type="html">&lt;p&gt;It&amp;#8217;s been a while since I last updated this blog. I did a talk at &lt;a href="http://bigdatascala.bythebay.io/"&gt;Big Data Scala&lt;/a&gt; this summer and here are the &lt;a href="http://www.slideshare.net/sinisalyh/scala-data-pipelines-spotify"&gt;slides&lt;/a&gt;&lt;/p&gt;
&lt;iframe src="//www.slideshare.net/slideshow/embed_code/key/10GyruQgE9UUpv" width="800" height="490" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen&gt; &lt;/iframe&gt;

&lt;p&gt;&lt;div style="margin-bottom:5px"&gt; &lt;strong&gt; &lt;a href="//www.slideshare.net/sinisalyh/scala-data-pipelines-spotify" title="Scala Data Pipelines @ Spotify" target="_blank"&gt;Scala Data Pipelines @ Spotify&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href="//www.slideshare.net/sinisalyh" target="_blank"&gt;Neville Li&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;It&amp;#8217;s been a while since I last updated this blog. I did a talk at &lt;a href="http://bigdatascala.bythebay.io/"&gt;Big Data Scala&lt;/a&gt; this summer and here are the &lt;a href="http://www.slideshare.net/sinisalyh/scala-data-pipelines-spotify"&gt;slides&lt;/a&gt;&lt;/p&gt;
&lt;iframe src="//www.slideshare.net/slideshow/embed_code/key/10GyruQgE9UUpv" width="800" height="490" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen&gt; &lt;/iframe&gt;

&lt;p&gt;&lt;div style="margin-bottom:5px"&gt; &lt;strong&gt; &lt;a href="//www.slideshare.net/sinisalyh/scala-data-pipelines-spotify" title="Scala Data Pipelines @ Spotify" target="_blank"&gt;Scala Data Pipelines @ Spotify&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href="//www.slideshare.net/sinisalyh" target="_blank"&gt;Neville Li&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;&lt;/p&gt;</content><category term="data"></category><category term="scala"></category><category term="scalding"></category></entry><entry><title>Primitives</title><link href="https://www.lyh.me/primitives.html" rel="alternate"></link><published>2015-05-14T08:50:00-04:00</published><updated>2015-05-14T08:50:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2015-05-14:/primitives.html</id><summary type="html">&lt;p&gt;Another day, another talk. This one is on primitives and here are the &lt;a href="/slides/primitives.html"&gt;slides&lt;/a&gt;&lt;/p&gt;
&lt;iframe src="/slides/primitives.html" width="800" height="450"&gt;&lt;/iframe&gt;</summary><content type="html">&lt;p&gt;Another day, another talk. This one is on primitives and here are the &lt;a href="/slides/primitives.html"&gt;slides&lt;/a&gt;&lt;/p&gt;
&lt;iframe src="/slides/primitives.html" width="800" height="450"&gt;&lt;/iframe&gt;</content><category term="java"></category><category term="scala"></category><category term="fp"></category></entry><entry><title>Type Classes</title><link href="https://www.lyh.me/type-classes.html" rel="alternate"></link><published>2015-04-20T15:39:00-04:00</published><updated>2015-04-20T15:39:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2015-04-20:/type-classes.html</id><summary type="html">&lt;p&gt;I started giving more Scala talks internally at &lt;a href="http://www.spotify.com/"&gt;Spotify&lt;/a&gt;. The first one is on type classes and here are the &lt;a href="/slides/type-classes.html"&gt;slides&lt;/a&gt;&lt;/p&gt;
&lt;iframe src="/slides/type-classes.html" width="800" height="450"&gt;&lt;/iframe&gt;</summary><content type="html">&lt;p&gt;I started giving more Scala talks internally at &lt;a href="http://www.spotify.com/"&gt;Spotify&lt;/a&gt;. The first one is on type classes and here are the &lt;a href="/slides/type-classes.html"&gt;slides&lt;/a&gt;&lt;/p&gt;
&lt;iframe src="/slides/type-classes.html" width="800" height="450"&gt;&lt;/iframe&gt;</content><category term="scala"></category><category term="fp"></category></entry><entry><title>NEScala 2015 talk</title><link href="https://www.lyh.me/nescala-2015-talk.html" rel="alternate"></link><published>2015-02-04T11:02:00-05:00</published><updated>2015-02-04T11:02:00-05:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2015-02-04:/nescala-2015-talk.html</id><summary type="html">&lt;p&gt;I gave a lightning talk at &lt;a href="http://www.nescala.org/"&gt;Northeast Scala Symposium&lt;/a&gt; last week on Macros in Datapipelines and here are the &lt;a href="/slides/macros.html"&gt;slides&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src="/slides/macros.html" width="800" height="450"&gt;&lt;/iframe&gt;</summary><content type="html">&lt;p&gt;I gave a lightning talk at &lt;a href="http://www.nescala.org/"&gt;Northeast Scala Symposium&lt;/a&gt; last week on Macros in Datapipelines and here are the &lt;a href="/slides/macros.html"&gt;slides&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src="/slides/macros.html" width="800" height="450"&gt;&lt;/iframe&gt;</content><category term="avro"></category><category term="macro"></category><category term="parquet"></category><category term="scala"></category></entry><entry><title>Fun with macros and parquet-avro</title><link href="https://www.lyh.me/fun-with-macros-and-parquet-avro.html" rel="alternate"></link><published>2015-01-08T14:01:00-05:00</published><updated>2015-01-08T14:01:00-05:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2015-01-08:/fun-with-macros-and-parquet-avro.html</id><summary type="html">&lt;p&gt;I recently had some fun building &lt;a href="https://github.com/nevillelyh/parquet-avro-extra"&gt;parquet-avro-extra&lt;/a&gt;, an add-on module for &lt;a href="https://github.com/Parquet/parquet-mr/tree/master/parquet-avro"&gt;parquet-avro&lt;/a&gt; using &lt;a href="http://scalamacros.org/"&gt;Scala macros&lt;/a&gt;. I did it mainly to learn Scala macros but also to make it easier to use &lt;a href="http://parquet.incubator.apache.org/"&gt;Parquet&lt;/a&gt; with &lt;a href="http://avro.apache.org/"&gt;Avro&lt;/a&gt; in a data&amp;nbsp;pipeline.&lt;/p&gt;
&lt;h2&gt;Parquet and&amp;nbsp;Avro&lt;/h2&gt;
&lt;p&gt;Parquet is a columnar storage system designed for &lt;span class="caps"&gt;HDFS …&lt;/span&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;I recently had some fun building &lt;a href="https://github.com/nevillelyh/parquet-avro-extra"&gt;parquet-avro-extra&lt;/a&gt;, an add-on module for &lt;a href="https://github.com/Parquet/parquet-mr/tree/master/parquet-avro"&gt;parquet-avro&lt;/a&gt; using &lt;a href="http://scalamacros.org/"&gt;Scala macros&lt;/a&gt;. I did it mainly to learn Scala macros but also to make it easier to use &lt;a href="http://parquet.incubator.apache.org/"&gt;Parquet&lt;/a&gt; with &lt;a href="http://avro.apache.org/"&gt;Avro&lt;/a&gt; in a data&amp;nbsp;pipeline.&lt;/p&gt;
&lt;h2&gt;Parquet and&amp;nbsp;Avro&lt;/h2&gt;
&lt;p&gt;Parquet is a columnar storage system designed for &lt;span class="caps"&gt;HDFS&lt;/span&gt;. It offers some nice improvements over row-major systems including better compression and less I/O with column projection and predicate pushdown. Avro is a data serialization system that enables type-safe access to structured data with complex schema. The &lt;code&gt;parquet-avro&lt;/code&gt; module makes it possible to store data in Parquet format on disk and process them as Avro objects inside a &lt;span class="caps"&gt;JVM&lt;/span&gt; data pipeline like &lt;a href="https://github.com/twitter/scalding"&gt;Scalding&lt;/a&gt; or &lt;a href="http://spark.apache.org/"&gt;Spark&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Projection&lt;/h2&gt;
&lt;p&gt;Parquet allows reading only a subset of columns via projection. Here&amp;#8217;s an Scalding &lt;a href="https://github.com/epishkin/scalding/tree/parquet_avro/scalding-parquet"&gt;example&lt;/a&gt; from &lt;a href="http://www.tapad.com/"&gt;Tapad&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nc"&gt;Projection&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Signal&lt;/span&gt;&lt;span class="o"&gt;](&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;field1&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;field2.field2a&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note that fields specifications are strings even though the &lt;span class="caps"&gt;API&lt;/span&gt; has access to Avro type &lt;code&gt;Signal&lt;/code&gt; which has strongly typed getter&amp;nbsp;methods.&lt;/p&gt;
&lt;p&gt;This is slightly counter-intuitive since most Scala developers are used to transformations like &lt;code&gt;pipe.map(_.getField)&lt;/code&gt;. It&amp;#8217;s however can be easily solved with macro since the syntax tree of is accessible. A modified version has signature of &lt;code&gt;def apply[T](getters: (T =&amp;gt; Any)*): Schema&lt;/code&gt; and can be used like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nc"&gt;Projection&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Signal&lt;/span&gt;&lt;span class="o"&gt;](&lt;/span&gt;&lt;span class="k"&gt;_&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getField1&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="k"&gt;_&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getField2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getField2a&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The macro version looks more natural plus you get auto-complete support from the &lt;span class="caps"&gt;IDE&lt;/span&gt; and avoid&amp;nbsp;typos.&lt;/p&gt;
&lt;h2&gt;Predicate&lt;/h2&gt;
&lt;p&gt;Predicate is an even better use case for macros. The Parquet predicate &lt;span class="caps"&gt;API&lt;/span&gt; supports a fixed set of column types and operators, and the user must use the correct factory methods to construct an expression tree. A simple lambda like &lt;code&gt;i: Item =&amp;gt; i.price &amp;lt; 100 &amp;amp;&amp;amp; i.getReviews &amp;gt;= 10&lt;/code&gt; becomes&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;parquet.filter2.predicate.FilterApi&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;parquet.filter2.predicate.FilterPredicate&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;

&lt;span class="n"&gt;FilterPredicate&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;FilterApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
  &lt;span class="n"&gt;FilterApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;lt&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;FilterApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;floatColumn&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;price&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt;
  &lt;span class="n"&gt;FilterApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;gteq&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;FilterApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;intColumn&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;reviews&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Obviously this very cumbersome and even worse than the projection case. But with macros it feels almost like writing a regular Scala predicate&amp;nbsp;lambda:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nc"&gt;Predicate&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Item&lt;/span&gt;&lt;span class="o"&gt;](&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getPrice&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getReviews&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Lessons&amp;nbsp;learned&lt;/h2&gt;
&lt;p&gt;I have some experience with C++ templates and Clojure macros, but Scala macros is still pretty challenging to get started. A couple of&amp;nbsp;notes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Since one can write pretty complex code inside a macro, I had to remind myself that they don&amp;#8217;t compute data at runtime, but merely transform the syntax&amp;nbsp;tree.&lt;/li&gt;
&lt;li&gt;Pattern matching and deconstruction are handy for extracting tree&amp;nbsp;elements.&lt;/li&gt;
&lt;li&gt;Quasiquotes can be chained and returned in recursion for complex transformations, just be aware of the different types&amp;nbsp;first.&lt;/li&gt;
&lt;li&gt;It&amp;#8217;s great exercise for your recursion&amp;nbsp;skills.&lt;/li&gt;
&lt;/ul&gt;</content><category term="avro"></category><category term="macro"></category><category term="parquet"></category><category term="scala"></category></entry><entry><title>Three Reasons a Data Engineer Should Learn Scala</title><link href="https://www.lyh.me/three-reasons-a-data-engineer-should-learn-scala.html" rel="alternate"></link><published>2014-11-17T23:15:00-05:00</published><updated>2014-11-17T23:15:00-05:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-11-17:/three-reasons-a-data-engineer-should-learn-scala.html</id><summary type="html">&lt;p&gt;&lt;em&gt;This article was written in collaboration with &lt;a href="https://www.hakkalabs.co"&gt;Hakka Labs&lt;/a&gt; (&lt;a href="https://www.hakkalabs.co/articles/three-reasons-data-eng-learn-scala"&gt;original link&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;There has been a lot of debate over Scala lately, including criticisms like &lt;a href="http://java.dzone.com/articles/i-dont-scala"&gt;this&lt;/a&gt;, &lt;a href="http://overwatering.org/blog/2013/12/scala-1-star-would-not-program-again/"&gt;this&lt;/a&gt;, &lt;a href="http://www.infoq.com/news/2011/11/yammer-scala"&gt;this&lt;/a&gt;, and defenses like &lt;a href="http://blog.gridgainsystems.com/in-defense-of-scala-response-to-i-dont-like-scala/"&gt;this&lt;/a&gt; and &lt;a href="http://blog.gridgainsystems.com/in-defense-of-scala-part-2/"&gt;this&lt;/a&gt;. Most of the criticisms seem to focus on the language&amp;#8217;s complexity, performance, and integration with existing …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;This article was written in collaboration with &lt;a href="https://www.hakkalabs.co"&gt;Hakka Labs&lt;/a&gt; (&lt;a href="https://www.hakkalabs.co/articles/three-reasons-data-eng-learn-scala"&gt;original link&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;There has been a lot of debate over Scala lately, including criticisms like &lt;a href="http://java.dzone.com/articles/i-dont-scala"&gt;this&lt;/a&gt;, &lt;a href="http://overwatering.org/blog/2013/12/scala-1-star-would-not-program-again/"&gt;this&lt;/a&gt;, &lt;a href="http://www.infoq.com/news/2011/11/yammer-scala"&gt;this&lt;/a&gt;, and defenses like &lt;a href="http://blog.gridgainsystems.com/in-defense-of-scala-response-to-i-dont-like-scala/"&gt;this&lt;/a&gt; and &lt;a href="http://blog.gridgainsystems.com/in-defense-of-scala-part-2/"&gt;this&lt;/a&gt;. Most of the criticisms seem to focus on the language&amp;#8217;s complexity, performance, and integration with existing tools and libraries, while some praise its elegant syntax, powerful type system, and good fit for domain-specific&amp;nbsp;languages.&lt;/p&gt;
&lt;p&gt;However most of the discussions seem based on experiences building production backend or web systems where there are a lot of other options already. There are mature, battle tested options like Java, Erlang or even &lt;span class="caps"&gt;PHP&lt;/span&gt;, and there are Go, node.js, or Python for those who are more adventurous or prefer agility over&amp;nbsp;performance.&lt;/p&gt;
&lt;p&gt;Here I want to argue that there&amp;#8217;s a best tool for every job, and Scala shines for data processing and machine learning, for the following&amp;nbsp;reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;good balance between productivity and&amp;nbsp;performance&lt;/li&gt;
&lt;li&gt;integration with big data&amp;nbsp;ecosystem&lt;/li&gt;
&lt;li&gt;functional&amp;nbsp;paradigm&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Productivity without sacrificing&amp;nbsp;performance&lt;/h2&gt;
&lt;p&gt;In the big data &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; machine learning world where most developers are from Python/R/Matlab background, Scala&amp;#8217;s syntax, or the subset needed for the domain, is a lot less intimidating than that of Java or C++. In my experience, basic syntax collections &lt;span class="caps"&gt;API&lt;/span&gt; and lambda (about 20% of the language features) is all that&amp;#8217;s needed for a new hire with no prior experience to become productive in processing data. Libraries like &lt;a href="https://github.com/scalanlp/breeze"&gt;Breeze&lt;/a&gt;, &lt;a href="https://code.google.com/p/scalalab/"&gt;ScalaLab&lt;/a&gt; and &lt;a href="https://github.com/BIDData/BIDMach"&gt;BIDMach&lt;/a&gt; mimic syntax of popular tools with operator overloading and other syntactic sugar which are otherwise impossible in many mainstream languages. At the same time, performance is usually better than traditional tools like Python or R. As one&amp;#8217;s skill develops over time, there&amp;#8217;s a clear transition path from imperative to more elegant &lt;span class="caps"&gt;FP&lt;/span&gt; style code while maintaining or even improving&amp;nbsp;performance.&lt;/p&gt;
&lt;p&gt;The chart below clearly shows the growth of our main &lt;a href="https://github.com/twitter/scalding"&gt;scalding&lt;/a&gt; repository over time. We spent a few months experimenting and after doubling the team size in early 2014, the number of jobs and &lt;span class="caps"&gt;LOC&lt;/span&gt; also exploded. Most developers have little Scala or even Java experience and some of the jobs are doing complex machine learning&amp;nbsp;stuff. &lt;/p&gt;
&lt;p&gt;&lt;img alt="rec-sys-scalding" src="https://www.lyh.me/images/rec-sys-scalding.jpg"&gt;&lt;/p&gt;
&lt;h2&gt;Ecosystem&lt;/h2&gt;
&lt;p&gt;Scala also integrates well with the big data eco-system, which is mostly &lt;span class="caps"&gt;JVM&lt;/span&gt; based. There are frameworks on top of Java libraries like Scalding (Cascading), &lt;a href="https://github.com/twitter/summingbird"&gt;Summingbird&lt;/a&gt; (Scalding and Storm), &lt;a href="http://crunch.apache.org/scrunch.html"&gt;Scrunch&lt;/a&gt; (Crunch), &lt;a href="http://flink.incubator.apache.org/"&gt;Flink&lt;/a&gt; (Java core with Scala &lt;span class="caps"&gt;API&lt;/span&gt;), and ones built from scratch but interface with &lt;span class="caps"&gt;JVM&lt;/span&gt; systems, like &lt;a href="http://spark.apache.org/"&gt;Spark&lt;/a&gt; and &lt;a href="http://kafka.apache.org/"&gt;Kafka&lt;/a&gt;. The Scala APIs are usually more flexible than say Hadoop streaming with Python/Perl, PySpark or Python/Ruby bolts in Storm, since you have direct access to the underlying &lt;span class="caps"&gt;API&lt;/span&gt;. There are also a wide range of data storage solutions that are built for or work well with &lt;span class="caps"&gt;JVM&lt;/span&gt; like &lt;a href="http://cassandra.apache.org/"&gt;Cassandra&lt;/a&gt;, &lt;a href="http://hbase.apache.org/"&gt;HBase&lt;/a&gt;, &lt;a href="http://www.project-voldemort.com/voldemort/"&gt;Voldemort&lt;/a&gt; and &lt;a href="http://www.datomic.com/"&gt;Datomic&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Functional&amp;nbsp;paradigm&lt;/h2&gt;
&lt;p&gt;A third benefit is the functional paradigm which fits well within the Map/Reduce and big data model. Batch processing works on top of immutable data, transforms with map and reduce operations, and generates new copies. Real time log streams are essentially lazy streams. Most Scala data frameworks have the notion of some abstract data type that&amp;#8217;s extremely consistent with Scala&amp;#8217;s collection &lt;span class="caps"&gt;API&lt;/span&gt;. A glance at &lt;a href="http://twitter.github.io/scalding/com/twitter/scalding/typed/TypedPipe.html"&gt;TypedPipe&lt;/a&gt; in Scalding and &lt;a href="http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.rdd.RDD"&gt;&lt;span class="caps"&gt;RDD&lt;/span&gt;&lt;/a&gt; in Spark, and you&amp;#8217;ll see that they all have the same set of methods, e.g. map, flatMap, filter, reduce, fold and groupBy. One could just learn the standard collection and easily pick up one of the libraries. Many libraries also have frequent reference of category theory, more specifically properties of semigroup, monoid, and group to guarantee the correctness of distributed operations. Equipped such knowledge it&amp;#8217;ll be a lot easier to understand techniques like map-side&amp;nbsp;reduce.&lt;/p&gt;
&lt;p&gt;With these benefits I would say Scala is here to stay in the big data world and there are few contenders close in the&amp;nbsp;competition.&lt;/p&gt;</content><category term="data"></category><category term="scala"></category></entry><entry><title>Scala Workshop</title><link href="https://www.lyh.me/scala-workshop.html" rel="alternate"></link><published>2014-10-04T21:52:00-04:00</published><updated>2014-10-04T21:52:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-10-04:/scala-workshop.html</id><summary type="html">&lt;p&gt;While there are many Scala tutorials and books available, very few of them focus on big data. I did a couple of workshops at Spotify focusing on these areas and here are the &lt;a href="/slides/workshop.html"&gt;slides&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src="/slides/workshop.html" width="800" height="450"&gt;&lt;/iframe&gt;</summary><content type="html">&lt;p&gt;While there are many Scala tutorials and books available, very few of them focus on big data. I did a couple of workshops at Spotify focusing on these areas and here are the &lt;a href="/slides/workshop.html"&gt;slides&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src="/slides/workshop.html" width="800" height="450"&gt;&lt;/iframe&gt;</content><category term="fp"></category><category term="scala"></category><category term="data"></category></entry><entry><title>Using CQL with legacy column families</title><link href="https://www.lyh.me/using-cql-with-legacy-column-families.html" rel="alternate"></link><published>2014-09-13T20:47:00-04:00</published><updated>2014-09-13T20:47:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-09-13:/using-cql-with-legacy-column-families.html</id><summary type="html">&lt;p&gt;We use &lt;a href="http://cassandra.apache.org/"&gt;Cassandra&lt;/a&gt; extensively &lt;a href="http://www.slideshare.net/JimmyMrdell/playlists-at-spotify-cassandra-summit-london-2013?related=1"&gt;at work&lt;/a&gt;, and up till recently we&amp;#8217;ve been using mostly Cassandra 1.2 with &lt;a href="https://github.com/Netflix/astyanax"&gt;Astyanax&lt;/a&gt; and &lt;a href="https://thrift.apache.org/"&gt;Thrift&lt;/a&gt; protocol in Java applications. Very recently we started adopting Cassandra 2.0 with &lt;span class="caps"&gt;CQL&lt;/span&gt;, &lt;a href="https://github.com/datastax/java-driver"&gt;DataStax Java Driver&lt;/a&gt; and binary&amp;nbsp;protocol.&lt;/p&gt;
&lt;p&gt;While one should move to &lt;span class="caps"&gt;CQL&lt;/span&gt; schema to …&lt;/p&gt;</summary><content type="html">&lt;p&gt;We use &lt;a href="http://cassandra.apache.org/"&gt;Cassandra&lt;/a&gt; extensively &lt;a href="http://www.slideshare.net/JimmyMrdell/playlists-at-spotify-cassandra-summit-london-2013?related=1"&gt;at work&lt;/a&gt;, and up till recently we&amp;#8217;ve been using mostly Cassandra 1.2 with &lt;a href="https://github.com/Netflix/astyanax"&gt;Astyanax&lt;/a&gt; and &lt;a href="https://thrift.apache.org/"&gt;Thrift&lt;/a&gt; protocol in Java applications. Very recently we started adopting Cassandra 2.0 with &lt;span class="caps"&gt;CQL&lt;/span&gt;, &lt;a href="https://github.com/datastax/java-driver"&gt;DataStax Java Driver&lt;/a&gt; and binary&amp;nbsp;protocol.&lt;/p&gt;
&lt;p&gt;While one should move to &lt;span class="caps"&gt;CQL&lt;/span&gt; schema to take full advantage of the new protocol and storage engine, it&amp;#8217;s still possible to use &lt;span class="caps"&gt;CQL&lt;/span&gt; and the new driver on existing clusters. Say we have a legacy column family with &lt;code&gt;UTF8Type&lt;/code&gt; for row/column keys and &lt;code&gt;BytesType&lt;/code&gt; for values, it would look like this in &lt;code&gt;cassandra-cli&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;create&lt;/span&gt; &lt;span class="k"&gt;column&lt;/span&gt; &lt;span class="n"&gt;family&lt;/span&gt; &lt;span class="k"&gt;data&lt;/span&gt;
  &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;column_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Standard&amp;#39;&lt;/span&gt;
  &lt;span class="k"&gt;and&lt;/span&gt; &lt;span class="n"&gt;comparator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;UTF8Type&amp;#39;&lt;/span&gt;
  &lt;span class="k"&gt;and&lt;/span&gt; &lt;span class="n"&gt;default_validation_class&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;BytesType&amp;#39;&lt;/span&gt;
  &lt;span class="k"&gt;and&lt;/span&gt; &lt;span class="n"&gt;key_validation_class&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;UTF8Type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And this in &lt;code&gt;cqlsh&lt;/code&gt; after setting &lt;code&gt;start_native_transport: true&lt;/code&gt; in &lt;code&gt;cassandra.yaml&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="k"&gt;data&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
  &lt;span class="k"&gt;key&lt;/span&gt; &lt;span class="nb"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="n"&gt;column1&lt;/span&gt; &lt;span class="nb"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="nb"&gt;blob&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="k"&gt;PRIMARY&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;column1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="n"&gt;COMPACT&lt;/span&gt; &lt;span class="k"&gt;STORAGE&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In this table, &lt;code&gt;key&lt;/code&gt; and &lt;code&gt;column1&lt;/code&gt; corresponds to row and column keys in the legacy column family and &lt;code&gt;value&lt;/code&gt; corresponds to column&amp;nbsp;value.&lt;/p&gt;
&lt;p&gt;Queries to look up a column value, an entire row, and selected columns in a row would look like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;mykeyspace&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="k"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rowkey&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="n"&gt;column1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;colkey&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;column1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;mykeyspace&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="k"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rowkey&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;column1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;mykeyspace&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="k"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rowkey&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="n"&gt;column1&lt;/span&gt; &lt;span class="k"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;colkey1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;colkey2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And I found &lt;a href="http://www.slideshare.net/DataStax/understanding-how-cql3-maps-to-cassandras-internal-data-structure"&gt;these slides&lt;/a&gt; that explain the mapping bewteen &lt;span class="caps"&gt;CQL&lt;/span&gt; and Cassandra&amp;#8217;s storage&amp;nbsp;model.&lt;/p&gt;</content><category term="cassandra"></category><category term="cql"></category></entry><entry><title>dotfiles update</title><link href="https://www.lyh.me/dotfiles-update.html" rel="alternate"></link><published>2014-08-21T22:14:00-04:00</published><updated>2014-08-21T22:14:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-08-21:/dotfiles-update.html</id><summary type="html">&lt;p&gt;I&amp;#8217;ve been using my current &lt;a href="https://www.lyh.me/dotfiles.html"&gt;dotfiles&lt;/a&gt; setup for a while and felt it&amp;#8217;s time to freshen up. I focused on updating the look and feel of Vim and tmux this&amp;nbsp;round.&lt;/p&gt;
&lt;p&gt;First I switched to &lt;a href="https://github.com/tomasr/molokai"&gt;molokai&lt;/a&gt; color theme for Vim, &lt;a href="http://macromates.com/"&gt;TextMate&lt;/a&gt; (monokai) and &lt;a href="http://www.jetbrains.com/idea/"&gt;IntelliJ &lt;span class="caps"&gt;IDEA&lt;/span&gt;&lt;/a&gt; (using &lt;a href="https://github.com/y3sh/Intellij-Colors-Sublime-Monokai"&gt;this&lt;/a&gt;). I …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I&amp;#8217;ve been using my current &lt;a href="https://www.lyh.me/dotfiles.html"&gt;dotfiles&lt;/a&gt; setup for a while and felt it&amp;#8217;s time to freshen up. I focused on updating the look and feel of Vim and tmux this&amp;nbsp;round.&lt;/p&gt;
&lt;p&gt;First I switched to &lt;a href="https://github.com/tomasr/molokai"&gt;molokai&lt;/a&gt; color theme for Vim, &lt;a href="http://macromates.com/"&gt;TextMate&lt;/a&gt; (monokai) and &lt;a href="http://www.jetbrains.com/idea/"&gt;IntelliJ &lt;span class="caps"&gt;IDEA&lt;/span&gt;&lt;/a&gt; (using &lt;a href="https://github.com/y3sh/Intellij-Colors-Sublime-Monokai"&gt;this&lt;/a&gt;). I guess I grew tired of the old trusted &lt;a href="http://ethanschoonover.com/solarized"&gt;solarized&lt;/a&gt;, plus with my new MacBook Pro 13&amp;#8221; at highest resolution, it just doesn&amp;#8217;t feel sharp&amp;nbsp;enough.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://github.com/Lokaltog/vim-powerline"&gt;vim-powerline&lt;/a&gt; plugin I was using is being deprecated and replaced by &lt;a href="https://github.com/Lokaltog/powerline"&gt;powerline&lt;/a&gt;, which supports vim, tmux, zsh, and many others. However it requires Python and I had trouble using it with some really old Vim versions at work. So instead I switched to a pure VimL plugin, &lt;a href="https://github.com/bling/vim-airline"&gt;vim-airline&lt;/a&gt;. Not surprisingly there&amp;#8217;s a companion plugin, &lt;a href="https://github.com/edkolev/tmuxline.vim"&gt;tmuxline&lt;/a&gt; for tmux as well. Both have no extra dependencies which is a big plus for me since I use the same dotfiles on Mac, my Ubuntu Trusty destop at work, and many Debian Squeeze&amp;nbsp;servers.&lt;/p&gt;
&lt;p&gt;I also updated a couple of other Vim plugins along the process, replacing &lt;a href="https://github.com/garbas/vim-snipmate"&gt;vim-snipmate&lt;/a&gt; with &lt;a href="https://github.com/SirVer/ultisnips"&gt;ultisnips&lt;/a&gt;, &lt;a href="https://github.com/bitc/vim-bad-whitespace"&gt;vim-bad-whitespace&lt;/a&gt; with &lt;a href="https://github.com/ntpeters/vim-better-whitespace"&gt;vim-better-whitespace&lt;/a&gt; (no pun intended), and adding &lt;a href="https://github.com/airblade/vim-gitgutter"&gt;vim-gutter&lt;/a&gt;. The biggest discovery is &lt;a href="https://github.com/Lokaltog/vim-easymotion"&gt;vim-easymotion&lt;/a&gt; though, perfect for jumping within long texts like this blog article. Just a few weeks ago an Emacs fanatic coworker was showing off his setup with &lt;a href="http://www.emacswiki.org/emacs/AceJump"&gt;AceJump&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This is what my revamped Vim in tmux setup looks like:
&lt;img alt="screen shot" src="https://www.lyh.me/images/dotfiles2.png"&gt;&lt;/p&gt;</content><category term="dotfiles"></category><category term="tmux"></category><category term="vim"></category></entry><entry><title>On being a polyglot</title><link href="https://www.lyh.me/on-being-a-polyglot.html" rel="alternate"></link><published>2014-08-21T21:26:00-04:00</published><updated>2014-08-21T21:26:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-08-21:/on-being-a-polyglot.html</id><summary type="html">&lt;p&gt;I&amp;#8217;m kind of known as a polyglot among coworkers. We would often argue that instead of hiring great Java/Python/C++ developers, we should rather strive to hire great engineers with strong &lt;span class="caps"&gt;CS&lt;/span&gt; fundamentals who can pick up any language easily. I came from scientific computing background, doing mostly …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I&amp;#8217;m kind of known as a polyglot among coworkers. We would often argue that instead of hiring great Java/Python/C++ developers, we should rather strive to hire great engineers with strong &lt;span class="caps"&gt;CS&lt;/span&gt; fundamentals who can pick up any language easily. I came from scientific computing background, doing mostly C/C++/Python many years ago. Over the course of the last three years at my current job I coded seven languages professionally, some out of interest and some necessity. I enjoyed the experience learning all these different things and want to share my experience here, what I learned from each one of them and how it helps me becoming a better&amp;nbsp;engineer.&lt;/p&gt;
&lt;h2&gt;C&lt;/h2&gt;
&lt;p&gt;The first language I used seriously, apart from &lt;span class="caps"&gt;LOGO&lt;/span&gt; &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; &lt;span class="caps"&gt;BASIC&lt;/span&gt; when I was a kid of course. It&amp;#8217;s probably the closest thing one can get to the operating system and bare metal without dropping down to assembly (while you still can in C). It&amp;#8217;s a simple language whose syntax served as the basis of many successors like C++ &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; Java. It doesn&amp;#8217;t offer any fancy features like &lt;span class="caps"&gt;OOP&lt;/span&gt; or namespaces, but rather depends on the developer&amp;#8217;s skill for organizing large code base (think Linux kernel or&amp;nbsp;git).&lt;/p&gt;
&lt;p&gt;Memory management is probably the biggest thing one get from learning the language, and to this day I&amp;#8217;m still glad that I learned data structures in C. There are also other low level stuff like interrupts, system calls, and multi-threading which are often abstracted away in higher level languages. For these reasons I would argue that any professional developer should know some&amp;nbsp;C.&lt;/p&gt;
&lt;p&gt;I still remember programming my 9-pin dot-matrix printer with bit operators and ports; my first pre-Windows &lt;span class="caps"&gt;GUI&lt;/span&gt; with interrupts and &lt;span class="caps"&gt;VGA&lt;/span&gt; memory access; first e-mail client with &lt;span class="caps"&gt;UNIX&lt;/span&gt; sockets; first shell with all those Unix system calls; and learning two-phase commit by implementing it for &lt;a href="http://www.sqlite.org/"&gt;SQLite&lt;/a&gt;. While I rarely use C nowadays, many concepts pop up in day to day work and are essential in understanding much more complex&amp;nbsp;systems.&lt;/p&gt;
&lt;h2&gt;C++&lt;/h2&gt;
&lt;p&gt;A natural next step after C, C++ adds &lt;span class="caps"&gt;OOP&lt;/span&gt; and many more features like streams, operator overloading, and templates. Several books were instrumental to understanding the language better, including Scott Meyers&amp;#8217; &lt;a href="http://www.amazon.com/Effective-Specific-Improve-Programs-Designs/dp/0321334876"&gt;Effective C++&lt;/a&gt; series, and Stanley Lippman&amp;#8217;s &lt;a href="http://www.amazon.com/Inside-Object-Model-Stanley-Lippman/dp/0201834545"&gt;Inside the C++ Object Model&lt;/a&gt;. The former is regarded as a must read for all C++ programmers, while the latter dig into the language implementation of some mysterious features like object construction, virtual methods, and multiple inheritance. I actually read Effective C++ before studying the language. The first pass was not 100% clear but combined with practise and real world experience, the second read made a lot more sense and really made me comfortable with the&amp;nbsp;language.&lt;/p&gt;
&lt;p&gt;I started using it mostly in school for scientific computing, as &amp;#8220;C with classes&amp;#8221;, where one rarely relies on auto memory management &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; threading. Memory were allocated in big chunks, or managed with &lt;span class="caps"&gt;STL&lt;/span&gt; collections, and often read-only once loaded. And processing large amount of data is often embarrassingly parallel, i.e. crunching through input files in&amp;nbsp;threads.&lt;/p&gt;
&lt;p&gt;Fast forward to my current job, C++ is mostly used in the desktop application, heavily threaded with many small objects encapsulating asynchronous backend requests and JavaScript bridge with &lt;a href="https://code.google.com/p/chromiumembedded/"&gt;&lt;span class="caps"&gt;CEF&lt;/span&gt;&lt;/a&gt;. Race conditions, memory leaks and null pointer crashes are common problems and I started to appreciate mutexes &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; &lt;a href="http://www.boost.org/doc/libs/1_56_0/libs/smart_ptr/smart_ptr.htm"&gt;boost smart pointers&lt;/a&gt;. Features like &lt;a href="http://www.cprogramming.com/tutorial/template_specialization.html"&gt;template specialization&lt;/a&gt; also helps in creating generic &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; performant code while paving the way for understanding type classes in Scala &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;Haskell.&lt;/p&gt;
&lt;h2&gt;Python&lt;/h2&gt;
&lt;p&gt;Probably the most popular of the bunch, Python is favored by many data scientists for its wide range of data processing libraries and I originally picked it up for information retrieval. It&amp;#8217;s easy to learn, concise, and perfect for ad-hoc analysis or as a utility language. A colleague once said that any competent programmer should know one static and one dynamic language well, and in that case Python would be many people&amp;#8217;s choice for the dynamic&amp;nbsp;one.&lt;/p&gt;
&lt;p&gt;When it comes to implementing complex algorithms quickly, list comprehension got me hooked first. Then it was lambda, map, reduce, filter, zip and that was when I discovered functional programming. After that came things like &lt;a href="https://docs.python.org/2/library/itertools.html"&gt;itertools&lt;/a&gt; and &lt;a href="https://docs.python.org/2/library/functools.html"&gt;functools&lt;/a&gt;. To me Python was the gateway language to functional&amp;nbsp;programming.&lt;/p&gt;
&lt;p&gt;I also did a lot of backend work in Python, and learn to hate &lt;a href="https://wiki.python.org/moin/GlobalInterpreterLock"&gt;&lt;span class="caps"&gt;GIL&lt;/span&gt;&lt;/a&gt; and love &lt;a href="http://www.gevent.org/"&gt;gevent&lt;/a&gt;. Performance was still an issue and significant amount of time was spent profiling and optimizing code. And through the process I got a much better understanding of the non-blocking event-driven concurrency&amp;nbsp;model.&lt;/p&gt;
&lt;h2&gt;JavaScript&lt;/h2&gt;
&lt;p&gt;JavaScript is a language that I write out of necessity, mostly when working with &lt;a href="https://developer.spotify.com/technologies/apps/"&gt;Spotify Apps&lt;/a&gt; and my &lt;a href="http://labs.spotify.com/2013/11/14/announcing-spotify-visualization-api-beta/"&gt;audio visualization&lt;/a&gt; hack project. It&amp;#8217;s one of those languages that I never learned properly. While the language isn&amp;#8217;t drastically different from the previous ones, I did have to wrap my head around various (ab)uses of closure and the whole async requests and callbacks concept, and you learn to organize the code around that to make it more&amp;nbsp;maintainable.&lt;/p&gt;
&lt;h2&gt;Scala&lt;/h2&gt;
&lt;p&gt;I introduced Scala back to my current job and use it on a daily basis. There are a lot of controversy around the language, mostly due to its steep learn curve and complexity. Learning curve was not so much of a problem for someone who already knows Python and C++, although there are still concepts harder to digest, like variances, bounds and type classes. Complexity, &lt;span class="caps"&gt;IMHO&lt;/span&gt;, was partly due to the limitation of the &lt;span class="caps"&gt;JVM&lt;/span&gt;, e.g. erasure and boxed primitives. Despite these problems, Scala seems to have found a sweet spot in the domain of big data, where it allows both development agility and performance, plus interoperability with other &lt;span class="caps"&gt;JVM&lt;/span&gt; system (Hadoop, Storm, Cassandra, etc.). Apart from powerful generics and operator overloading, Scala took a step further from C++ with implicits, making it easier to extend existing libraries or design new DSLs. &lt;a href="https://github.com/twitter/scalding"&gt;Scalding&lt;/a&gt;, &lt;a href="http://spark.apache.org/"&gt;Spark&lt;/a&gt;, and &lt;a href="http://kafka.apache.org/"&gt;Kafka&lt;/a&gt; are probably the most well known Scala projects, while newcomers like &lt;a href="https://github.com/BIDData/BIDMach"&gt;BIDMach&lt;/a&gt; are showing a lot of&amp;nbsp;potential.&lt;/p&gt;
&lt;p&gt;When it comes to learning the language, Twitter&amp;#8217;s &lt;a href="https://twitter.github.io/scala_school/"&gt;Scala School&lt;/a&gt; and Horstmann&amp;#8217;s &lt;a href="http://www.horstmann.com/scala/"&gt;Scala for the Impatient&lt;/a&gt; are both excellent resources and I enjoyed Joshua Suereth&amp;#8217;s &lt;a href="http://www.manning.com/suereth/"&gt;Scala in Depth&lt;/a&gt; for advanced topics. The biggest reward, often absent from books &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; tutorials however, is abstract algebra and category theory. Sooner or later terms like monoid, semigroup, monad will pop up and you&amp;#8217;ll recognize such patterns in map/reduce, storm, and even Java libraries like &lt;a href="https://code.google.com/p/guava-libraries/"&gt;Guava&lt;/a&gt;. To me, that&amp;#8217;s the most important thing I learned from using&amp;nbsp;Scala.&lt;/p&gt;
&lt;h2&gt;Java&lt;/h2&gt;
&lt;p&gt;Another language I use out of necessity. It&amp;#8217;s often contempted in the start up world for verbosity and enterprise heritage. Most colleges teach Java in programming 101 and that was my only previous encounter with it (although I skipped most classes in school). The language has a very conservative set of features and probably not a challenge for any seasoned C++ developers. People often associate Java with design patterns, for better or worse, and &lt;span class="caps"&gt;IMHO&lt;/span&gt; a lot of them, like builder, factory, delegate, were really created to overcome the limitation of the&amp;nbsp;language.&lt;/p&gt;
&lt;p&gt;One area that Java excels in, however, is its ecosystem of libraries, tools, IDEs. Before Java I did almost all coding in Vim, using Xcode or Eclipse occasionally for debugging C++ code. After using &lt;a href="http://www.jetbrains.com/idea/"&gt;IntelliJ &lt;span class="caps"&gt;IDEA&lt;/span&gt;&lt;/a&gt; for a few weeks, I&amp;#8217;d say that it&amp;#8217;s probably the biggest attraction for writing Java. Verbosity becomes less of a problem once you get used to the &lt;span class="caps"&gt;IDE&lt;/span&gt;&amp;#8217;s features for code navigation, completion, and refactoring. Dependency management is also easier without various platform specific packages. And coming from doing backend in a Python world, the quality and maturity of libraries in the &lt;span class="caps"&gt;JVM&lt;/span&gt; world is so much better. We ended up spending a lot less time struggling with memcached, Cassandra or &lt;span class="caps"&gt;HTTP&lt;/span&gt;&amp;nbsp;clients.&lt;/p&gt;
&lt;h2&gt;Clojure&lt;/h2&gt;
&lt;p&gt;The latest language I used at work. We use it mainly for defining monitoring rules in &lt;a href="http://riemann.io/"&gt;Riemann&lt;/a&gt; and I also hacked together a few &lt;a href="http://storm-project.net/"&gt;Storm&lt;/a&gt; topologies in Clojure. With some Scala experience by the time I picked it up, most concepts are no stranger to me. Syntax is surprisingly simple and consistent. I often joke that it&amp;#8217;s my language of choice on a plane or boat with no internet, since the core language &lt;a href="http://clojure.org/cheatsheet"&gt;cheat sheet&lt;/a&gt; fits on a single page. And Its inherently lazy sequence library maps naturally to stream processing and is also fun for solving &lt;a href="http://projecteuler.net/"&gt;Project Euler&lt;/a&gt;&amp;nbsp;problems.&lt;/p&gt;
&lt;p&gt;Some coworkers were appalled by the excessive use of parentheses and existence of plugins like &lt;a href="https://github.com/kien/rainbow_parentheses.vim"&gt;rainbow_parentheses.vim&lt;/a&gt;. Yes we talk smack about it, joking that 40 columns is enough and one should hook up an elliptical machine to &lt;code&gt;(&lt;/code&gt; and &lt;code&gt;)&lt;/code&gt;. But I also think of it as a restraint of complexity and break my code down to smaller, reuseable&amp;nbsp;functions.&lt;/p&gt;
&lt;p&gt;Clojure is also the first time I was exposed to macros (not the &lt;code&gt;#define&lt;/code&gt; kind in C/C++), &lt;a href="http://en.wikipedia.org/wiki/Software_transactional_memory"&gt;software transactional memory&lt;/a&gt;, and &lt;a href="http://en.wikipedia.org/wiki/Homoiconicity"&gt;homoiconic&lt;/a&gt; programming languages. Concepts that broadened my understanding of programming language&amp;nbsp;design.&lt;/p&gt;
&lt;h2&gt;(Bonus)&amp;nbsp;Haskell&lt;/h2&gt;
&lt;p&gt;I always regretted not learning Haskell ever since switching to &lt;a href="http://xmonad.org/"&gt;XMonad&lt;/a&gt; as my window manager. If Python was my gateway drug to functional programming, then Scala, and more specifically &lt;a href="https://github.com/scalaz/scalaz"&gt;scalaz&lt;/a&gt;, are my gateway drug to Haskell, the pure functional programming language with strong academic&amp;nbsp;background.&lt;/p&gt;
&lt;p&gt;I recently picked up the language again, going through the excellent free book &lt;a href="http://learnyouahaskell.com/"&gt;Learn You a Haskell for Great Good!&lt;/a&gt; side by side with &lt;a href="http://eed3si9n.com/learning-scalaz/index.html"&gt;learning scalaz&lt;/a&gt;. It&amp;#8217;s easy to see the parallel between the two, how some concepts built into the Haskell language are implemented with generics and implicits in scala(z). It&amp;#8217;s also not hard to see why Haskell attracts interest, with its powerful type inferences, type classes, lazy evaluation and many other&amp;nbsp;features.&lt;/p&gt;
&lt;p&gt;I probably won&amp;#8217;t use Haskell for real any time soon. I probably won&amp;#8217;t even use those features in scalaz or &lt;a href="https://github.com/milessabin/shapeless"&gt;shapeless&lt;/a&gt; in production. Nevertheless I really enjoyed learning these concepts and see how they solve problems with&amp;nbsp;elegance.&lt;/p&gt;
&lt;h2&gt;Final&amp;nbsp;words&lt;/h2&gt;
&lt;p&gt;You might also say that I&amp;#8217;m a jack of all trades and master of none. This is very true and I never became a master of any of these languages and created a framework or library. On the other hand this also allows me to pick up any task or role within the team and quickly become productive. And I often found myself applying techniques from one language to another. All in all I believe it&amp;#8217;s much more beneficial to be a polyglot than sticking to one language and&amp;nbsp;platform.&lt;/p&gt;</content><category term="c"></category><category term="cpp"></category><category term="python"></category><category term="javascript"></category><category term="scala"></category><category term="java"></category><category term="clojure"></category><category term="haskell"></category></entry><entry><title>How many copies</title><link href="https://www.lyh.me/how-many-copies.html" rel="alternate"></link><published>2014-08-02T20:48:00-04:00</published><updated>2014-08-02T20:48:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-08-02:/how-many-copies.html</id><summary type="html">&lt;p&gt;One topic that came up a lot when optimizing Scala data applications is the performance of standard collections, or the hidden cost of temporary copies. The collections &lt;span class="caps"&gt;API&lt;/span&gt; is easy to learn and maps well to many Python concepts where a lot of data engineers are familiar with. But the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;One topic that came up a lot when optimizing Scala data applications is the performance of standard collections, or the hidden cost of temporary copies. The collections &lt;span class="caps"&gt;API&lt;/span&gt; is easy to learn and maps well to many Python concepts where a lot of data engineers are familiar with. But the performance penalty can be pretty big when it&amp;#8217;s repeated over millions of records in a &lt;span class="caps"&gt;JVM&lt;/span&gt; with limited&amp;nbsp;heap.&lt;/p&gt;
&lt;h2&gt;Mapping&amp;nbsp;values&lt;/h2&gt;
&lt;p&gt;Let&amp;#8217;s take a look at one most naive example first, mapping the values of a &lt;code&gt;Map&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="nc"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;toList&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_1&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;)).&lt;/span&gt;&lt;span class="n"&gt;toMap&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Looks simple enough but obviously not optimal. Two temporary &lt;code&gt;List[(String, Int)]&lt;/code&gt; were created, one from &lt;code&gt;toList&lt;/code&gt; and one from &lt;code&gt;map&lt;/code&gt;. &lt;code&gt;map&lt;/code&gt; also creates 3 copies of &lt;code&gt;(String, Int)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There are a few commonly seen variations. These don&amp;#8217;t create temporary collections but still key-value&amp;nbsp;tuples.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If one reads the &lt;a href="http://www.scala-lang.org/api/2.10.4/index.html#scala.collection.immutable.Map"&gt;ScalaDoc&lt;/a&gt; closely, there&amp;#8217;s a &lt;code&gt;mapValues&lt;/code&gt; method already and it probably is the shortest and most&amp;nbsp;performant.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mapValues&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;_&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Java&amp;nbsp;conversion&lt;/h2&gt;
&lt;p&gt;Similar problem exists when converting between Scala and Java collections. We store data on &lt;span class="caps"&gt;HDFS&lt;/span&gt; in &lt;a href="http://avro.apache.org/"&gt;Avro&lt;/a&gt; and one most commonly used data structure is high dimensional vector, represented as &lt;code&gt;java.util.List[java.lang.Float]&lt;/code&gt; in Avro and &lt;code&gt;Array[Float]&lt;/code&gt; in Scala and &lt;a href="https://github.com/scalanlp/breeze"&gt;breeze&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Since there&amp;#8217;s no direct conversion between Java &lt;code&gt;List&lt;/code&gt; and Scala &lt;code&gt;Array&lt;/code&gt;, the naive solution requires a temporary copy and looks like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;java.util.&lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nc"&gt;List&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nc"&gt;JList&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;java.lang.&lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nc"&gt;Float&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nc"&gt;JFloat&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;scala.collection.JavaConverters._&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="n"&gt;javaToArray&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;JList&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;JFloat&lt;/span&gt;&lt;span class="o"&gt;])&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Float&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;asScala&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;asInstanceOf&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;List&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Float&lt;/span&gt;&lt;span class="o"&gt;]].&lt;/span&gt;&lt;span class="n"&gt;toArray&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="n"&gt;arrayToJava&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Float&lt;/span&gt;&lt;span class="o"&gt;])&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;JList&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;JFloat&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;toList&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;asInstanceOf&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;List&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;JFloat&lt;/span&gt;&lt;span class="o"&gt;]].&lt;/span&gt;&lt;span class="n"&gt;asJava&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The conversion is almost 10 times faster by doing the conversion manually in a&amp;nbsp;loop.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="n"&gt;javaToArray&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;JList&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;JFloat&lt;/span&gt;&lt;span class="o"&gt;])&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Float&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nc"&gt;Array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Float&lt;/span&gt;&lt;span class="o"&gt;](&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;var&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
  &lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iterator&lt;/span&gt;
  &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;next&lt;/span&gt;
    &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;r&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="n"&gt;arrayToJava&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;Float&lt;/span&gt;&lt;span class="o"&gt;])&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;JList&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;JFloat&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nc"&gt;JArrayList&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;JFloat&lt;/span&gt;&lt;span class="o"&gt;](&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;var&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
  &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;r&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Merging&amp;nbsp;maps&lt;/h2&gt;
&lt;p&gt;Same goes for merging 2 &lt;code&gt;Map[String, Double]&lt;/code&gt; by summing up values of duplicate keys. Both solutions below require 2 copies of key sets, one union/intersect&amp;nbsp;set,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="nc"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;3.0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="nc"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;1.5&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;3.5&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;// solution 1&lt;/span&gt;
&lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keySet&lt;/span&gt; &lt;span class="n"&gt;intersect&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keySet&lt;/span&gt;
&lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m2&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;  &lt;span class="c1"&gt;// -- i unnecessary&lt;/span&gt;
&lt;span class="n"&gt;m1&lt;/span&gt;  &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;               &lt;span class="c1"&gt;// slightly better&lt;/span&gt;

&lt;span class="c1"&gt;// solution 2&lt;/span&gt;
&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keySet&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keySet&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;map&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt;
  &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getOrElse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getOrElse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The best solution for this case also happens to be the shortest. It leverages the fact that pairs from the right-hand size of &lt;code&gt;++&lt;/code&gt; overwrite those on the left-hand size. One could even compare size of the maps and put the smaller on the right-hand size to further reduce&amp;nbsp;copies.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getOrElse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Cheating by&amp;nbsp;mutation&lt;/h2&gt;
&lt;p&gt;All of these optimizations are nice but sometimes they are just not enough. Imagine if the map merge operation is used in a &lt;code&gt;foldLeft&lt;/code&gt; on the reducer size, over millions of users with one &lt;code&gt;Map&lt;/code&gt; each, we&amp;#8217;ll be basically creating that many temporary copies and sometimes &lt;span class="caps"&gt;GC&lt;/span&gt; just can&amp;#8217;t keep up. Good thing is that in some cases we know for sure a temporary object won&amp;#8217;t be reused ever again, and can mutate it in place and pass it along to further reduce copying. In the example below &lt;span class="caps"&gt;LHS&lt;/span&gt; is mutated in place and returned in the binary&amp;nbsp;operation.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;scala.collection.mutable.&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nc"&gt;Map&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nc"&gt;MMap&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="n"&gt;mergeMaps&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;MMap&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;, &lt;span class="kt"&gt;Double&lt;/span&gt;&lt;span class="o"&gt;],&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;MMap&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;, &lt;span class="kt"&gt;Double&lt;/span&gt;&lt;span class="o"&gt;])&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;foreach&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;=&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getOrElse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;m1&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And in this &lt;code&gt;foldLeft&lt;/code&gt; operation, &lt;span class="caps"&gt;LHS&lt;/span&gt; is always the same object as initial value &lt;code&gt;z&lt;/code&gt; and mutated throughout the&amp;nbsp;group.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;val&lt;/span&gt; &lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="k"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Grouped&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;, &lt;span class="kt"&gt;MMap&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;, &lt;span class="kt"&gt;Double&lt;/span&gt;&lt;span class="o"&gt;]]&lt;/span&gt; &lt;span class="c1"&gt;// = ...&lt;/span&gt;
&lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;foldLeft&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;MMap&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;, &lt;span class="kt"&gt;Double&lt;/span&gt;&lt;span class="o"&gt;]())(&lt;/span&gt;&lt;span class="n"&gt;mergeMaps&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Some numeric libraries, like &lt;a href="http://mikiobraun.github.io/jblas/"&gt;&lt;span class="caps"&gt;JBLAS&lt;/span&gt;&lt;/a&gt; offer operators in both immutable (by copying) and mutable (by mutating in place) fashions. It&amp;#8217;s probably best to start with the immutable ones to ensure correctness, and drop down to mutating in place when running into performance&amp;nbsp;problems.&lt;/p&gt;</content><category term="data"></category><category term="performance"></category><category term="scala"></category></entry><entry><title>Why Functional? Why Scala?</title><link href="https://www.lyh.me/why-functional-why-scala.html" rel="alternate"></link><published>2014-07-28T23:03:00-04:00</published><updated>2014-07-28T23:03:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-07-28:/why-functional-why-scala.html</id><summary type="html">&lt;p&gt;I recently did an internal talk at Spotify on why every data engineer should know something about functional programming languages and Scala. And here are the &lt;a href="/slides/pitch.html"&gt;slides&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src="/slides/pitch.html" width="800" height="450"&gt;&lt;/iframe&gt;</summary><content type="html">&lt;p&gt;I recently did an internal talk at Spotify on why every data engineer should know something about functional programming languages and Scala. And here are the &lt;a href="/slides/pitch.html"&gt;slides&lt;/a&gt;.&lt;/p&gt;
&lt;iframe src="/slides/pitch.html" width="800" height="450"&gt;&lt;/iframe&gt;</content><category term="fp"></category><category term="scala"></category><category term="data"></category></entry><entry><title>Light Table</title><link href="https://www.lyh.me/light-table.html" rel="alternate"></link><published>2014-07-28T00:01:00-04:00</published><updated>2014-07-28T00:01:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-07-28:/light-table.html</id><summary type="html">&lt;p&gt;I recently picked up &lt;a href="http://www.lighttable.com/"&gt;Light Table&lt;/a&gt; for &lt;a href="http://clojure.org/"&gt;Clojure&lt;/a&gt; development and liked it. Form evaluation works out of the box and indentation is better than that in &lt;a href="http://plugins.jetbrains.com/plugin/?id=4050"&gt;La Clojure&lt;/a&gt; plugin for &lt;a href="http://www.jetbrains.com/idea/"&gt;IntelliJ &lt;span class="caps"&gt;IDEA&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I particularly like the idea of command bar, which allows you to search for Light Table commands by …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I recently picked up &lt;a href="http://www.lighttable.com/"&gt;Light Table&lt;/a&gt; for &lt;a href="http://clojure.org/"&gt;Clojure&lt;/a&gt; development and liked it. Form evaluation works out of the box and indentation is better than that in &lt;a href="http://plugins.jetbrains.com/plugin/?id=4050"&gt;La Clojure&lt;/a&gt; plugin for &lt;a href="http://www.jetbrains.com/idea/"&gt;IntelliJ &lt;span class="caps"&gt;IDEA&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I particularly like the idea of command bar, which allows you to search for Light Table commands by name and execute them quickly. I was already used to &lt;span class="caps"&gt;IDEA&lt;/span&gt;&amp;#8217;s key map though (&lt;code&gt;Mac OS X 10.5+&lt;/code&gt; which is more natural to Mac users than the default &lt;code&gt;Mac OS X&lt;/code&gt;), and wanted something similar. The setting files are in Clojure so it&amp;#8217;s easy to customize. This is what I got so far for &lt;code&gt;user.keymap&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;:+&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;:app&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;alt-space&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:show-commandbar-transient&lt;/span&gt;&lt;span class="p"&gt;]}&lt;/span&gt;

     &lt;span class="ss"&gt;:editor&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;alt-w&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:editor.watch.watch-selection&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="s"&gt;&amp;quot;alt-shift-w&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:editor.watch.unwatch&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="s"&gt;&amp;quot;ctrl-alt-i&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:smart-indent-selection&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="s"&gt;&amp;quot;ctrl-alt-c&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:toggle-console&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="s"&gt;&amp;quot;ctrl-shift-j&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:editor.sublime.joinLines&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="s"&gt;&amp;quot;pmeta-d&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:editor.sublime.duplicateLine&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="s"&gt;&amp;quot;pmeta-shift-up&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:editor.sublime.swapLineUp&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="s"&gt;&amp;quot;pmeta-shift-down&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:editor.sublime.swapLineDown&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="s"&gt;&amp;quot;pmeta-/&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:toggle-comment-selection&lt;/span&gt; &lt;span class="ss"&gt;:editor.line-down&lt;/span&gt;&lt;span class="p"&gt;]}}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Apart from these, I found myself using &lt;code&gt;"pmeta-enter" [:eval-editor-form]&lt;/code&gt; and &lt;code&gt;"ctrl-d" [:editor.doc.toggle]&lt;/code&gt; most when writing Clojure code. After all they are probably the most essential ones no matter what editor you use&amp;nbsp;:)&lt;/p&gt;</content><category term="clojure"></category><category term="intellij-idea"></category><category term="light-table"></category></entry><entry><title>dotfiles</title><link href="https://www.lyh.me/dotfiles.html" rel="alternate"></link><published>2014-07-27T09:43:00-04:00</published><updated>2014-07-27T09:43:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-07-27:/dotfiles.html</id><summary type="html">&lt;p&gt;My &lt;a href="https://github.com/nevillelyh/dotfiles/"&gt;dotfiles&lt;/a&gt; is probably the most copied code among my coworkers and today I will give a little break down of the code&amp;nbsp;base.&lt;/p&gt;
&lt;h2&gt;zsh&lt;/h2&gt;
&lt;p&gt;I switched to &lt;a href="http://www.zsh.org/"&gt;zsh&lt;/a&gt; 3 years ago and never looked back. There&amp;#8217;s also &lt;a href="https://github.com/robbyrussell/oh-my-zsh"&gt;oh-my-zsh&lt;/a&gt;, a framework for managing &lt;span class="caps"&gt;ZSH&lt;/span&gt; configuration. The features I found …&lt;/p&gt;</summary><content type="html">&lt;p&gt;My &lt;a href="https://github.com/nevillelyh/dotfiles/"&gt;dotfiles&lt;/a&gt; is probably the most copied code among my coworkers and today I will give a little break down of the code&amp;nbsp;base.&lt;/p&gt;
&lt;h2&gt;zsh&lt;/h2&gt;
&lt;p&gt;I switched to &lt;a href="http://www.zsh.org/"&gt;zsh&lt;/a&gt; 3 years ago and never looked back. There&amp;#8217;s also &lt;a href="https://github.com/robbyrussell/oh-my-zsh"&gt;oh-my-zsh&lt;/a&gt;, a framework for managing &lt;span class="caps"&gt;ZSH&lt;/span&gt; configuration. The features I found most useful&amp;nbsp;are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tab completion, including hostnames and&amp;nbsp;arguments&lt;/li&gt;
&lt;li&gt;History across multiple&amp;nbsp;sessions&lt;/li&gt;
&lt;li&gt;Plugins and&amp;nbsp;themes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;My &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.zshrc"&gt;.zshrc&lt;/a&gt; is mostly out of the box with some &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.dotfiles/zsh/zshrc"&gt;aliases&lt;/a&gt; and a few plugins thrown in but decided to create my own &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.dotfiles/zsh/sinisa.zsh-theme"&gt;theme&lt;/a&gt;. I use colors for hostname in the prompt, green for local and red for remote. I also tweaked &lt;code&gt;git&lt;/code&gt; status a bit to show untracked files (red dots), unstaged (yellow) &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; staged (green) changes, plus number stashed changes since that&amp;#8217;s the one thing I keep doing and forgetting&amp;nbsp;about.&lt;/p&gt;
&lt;h2&gt;git&lt;/h2&gt;
&lt;p&gt;I use &lt;code&gt;git&lt;/code&gt; both for work and personal projects, plus contributing to open source projects on &lt;a href="https://github.com/"&gt;GitHub&lt;/a&gt;. My &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.gitconfig"&gt;.gitconfig&lt;/a&gt; includes both a global &lt;code&gt;gitignore&lt;/code&gt; file and a &lt;code&gt;templatedir&lt;/code&gt;, which includes hooks for &lt;a href="http://ctags.sourceforge.net/"&gt;ctags&lt;/a&gt; and &lt;a href="https://code.google.com/p/gerrit/"&gt;Gerrit&lt;/a&gt;. The hooks are installed automatically for every&amp;nbsp;repo.&lt;/p&gt;
&lt;p&gt;Since I type hundreds of &lt;code&gt;git&lt;/code&gt; commands on a daily basis, I aliased &lt;code&gt;git&lt;/code&gt; to simply &lt;code&gt;g&lt;/code&gt; and added a bunch more for &lt;code&gt;checkout&lt;/code&gt;, &lt;code&gt;commit&lt;/code&gt;, &lt;code&gt;diff&lt;/code&gt;, &lt;code&gt;rebase&lt;/code&gt;, etc. I also added several log aliases with better formats, including one-liner color history, graph, and commits only by&amp;nbsp;me.&lt;/p&gt;
&lt;p&gt;I also have a few &lt;code&gt;git-*&lt;/code&gt; &lt;a href="https://github.com/nevillelyh/dotfiles/tree/master/.dotfiles/scripts"&gt;scripts&lt;/a&gt; to make my workflow a bit&amp;nbsp;easier.&lt;/p&gt;
&lt;h2&gt;vim&lt;/h2&gt;
&lt;p&gt;I&amp;#8217;ve been a &lt;code&gt;vim&lt;/code&gt; user for 15+ years and have come up with a pretty good set of settings and plugins. I keep most complex settings in a &lt;a href="https://github.com/nevillelyh/dotfiles/tree/master/.vim/vimrc.d"&gt;vimrc.d&lt;/a&gt; directory and load them from &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.vimrc"&gt;.vimrc&lt;/a&gt;, which is kept short with mostly look and feel plus some basic settings. This way I can easily copy just the &lt;code&gt;.vimrc&lt;/code&gt; to a remote server and have some decent setting to work&amp;nbsp;with.&lt;/p&gt;
&lt;p&gt;I depend on &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.vim/vimrc.d/vundle.vim"&gt;many plugins&lt;/a&gt; to get things done, roughly in the following&amp;nbsp;categories.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/Lokaltog/vim-powerline"&gt;vim-powerline&lt;/a&gt; and &lt;a href="https://github.com/altercation/vim-colors-solarized"&gt;vim-colors-solarized&lt;/a&gt; for look and feel. You might need to patch fonts for the fancy symbols&amp;nbsp;though.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/gregsexton/gitv"&gt;gitv&lt;/a&gt;, &lt;a href="https://github.com/tpope/vim-fugitive"&gt;vim-fugitive&lt;/a&gt; and &lt;a href="https://github.com/tpope/vim-git"&gt;vim-git&lt;/a&gt; for &lt;code&gt;git&lt;/code&gt; integration.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/majutsushi/tagbar"&gt;tagbar&lt;/a&gt; and &lt;a href="https://github.com/scrooloose/nerdtree"&gt;nerdtree&lt;/a&gt; for sidebar, which I mapped to &lt;code&gt;alt-1&lt;/code&gt; and &lt;code&gt;alt-2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/scrooloose/syntastic"&gt;syntastic&lt;/a&gt;, probably the most valuable one, integrates with &lt;a href="https://flake8.readthedocs.org/"&gt;flake8&lt;/a&gt; and other tools for syntax&amp;nbsp;checking.&lt;/li&gt;
&lt;li&gt;A few more for shortcuts like quotes, tab completion, and&amp;nbsp;commenting.&lt;/li&gt;
&lt;li&gt;And a few more for syntax highlighting of various programming languages that I work&amp;nbsp;with.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;tmux&lt;/h2&gt;
&lt;p&gt;As a data and backend engineer, I spend most of my time on remote servers and rely heavily on &lt;a href="http://tmux.sourceforge.net/"&gt;tmux&lt;/a&gt; for session management. I tend to create one session for each project and split windows when necessary for coding, tailing logs and interacting with the build&amp;nbsp;system.&lt;/p&gt;
&lt;p&gt;I changed my prefix from &lt;code&gt;ctrl-b&lt;/code&gt; to &amp;#96; since that&amp;#8217;s the least used key and not too hard to reach.I also added bindings to split a window horizontally and vertically, plus &lt;code&gt;vim&lt;/code&gt; style &lt;code&gt;hjkl&lt;/code&gt; keys to move around. I also use &lt;a href="https://github.com/erikw/tmux-powerline"&gt;tmux-powerline&lt;/a&gt; for a nicer status line. The same &lt;code&gt;vim-powerline&lt;/code&gt; fonts work here&amp;nbsp;too.&lt;/p&gt;
&lt;p&gt;One thing I noticed is that re-attached &lt;code&gt;screen&lt;/code&gt; or &lt;code&gt;tmux&lt;/code&gt; doesn&amp;#8217;t work well with &lt;span class="caps"&gt;SSH&lt;/span&gt; forwarding since the &lt;code&gt;SSH_AUTH_SOCK&lt;/code&gt; is different for each session. So I created a &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.dotfiles/zsh/zshrc#L55"&gt;snippet&lt;/a&gt; to &lt;code&gt;symlink&lt;/code&gt; sock files to the same&amp;nbsp;location.&lt;/p&gt;
&lt;h2&gt;xmonad&lt;/h2&gt;
&lt;p&gt;I use a Linux desktop at work and use &lt;a href="http://xmonad.org/"&gt;xmonad&lt;/a&gt; as my window manager. It&amp;#8217;s a tiling window manager which means instead of move and resize windows yourself, the manager tiles windows for you based on predefined layouts. Once I figured out a workflow, I found myself a lot more productive even when&amp;nbsp;multi-tasking.&lt;/p&gt;
&lt;p&gt;The main layout in my &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.xmonad/xmonad.hs"&gt;xmonad.hs&lt;/a&gt; uses left 3/5 of the screen for main window and the right 2/5 for others. The second layout splits horizontally 50/50 while the third is a grid layout, perfect for &lt;a href="http://sourceforge.net/projects/clusterssh/"&gt;Cluster &lt;span class="caps"&gt;SSH&lt;/span&gt;&lt;/a&gt; into many&amp;nbsp;servers.&lt;/p&gt;
&lt;p&gt;There are also a couple of key bindings, including ones to control &lt;a href="https://www.spotify.com/"&gt;Spotify&lt;/a&gt; via this &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.dotfiles/scripts/spotify.sh"&gt;shell script&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;bootstrapping&lt;/h2&gt;
&lt;p&gt;I started with putting my &lt;code&gt;HOME&lt;/code&gt; directory in a &lt;code&gt;git&lt;/code&gt; repo a few years ago, and over time added various dependencies across different platforms, e.g. &lt;a href="http://aptitude.alioth.debian.org/doc/en/"&gt;aptitude&lt;/a&gt;, &lt;a href="http://brew.sh/"&gt;homebrew&lt;/a&gt;, &lt;a href="http://pip.readthedocs.org/"&gt;pip&lt;/a&gt; and &lt;a href="https://github.com/gmarik/Vundle.vim"&gt;Vundle&lt;/a&gt;. Furthermore I access to a lot of virtual and bare-metal hosts and would like to streamline the processing of getting set up on a new&amp;nbsp;host.&lt;/p&gt;
&lt;p&gt;Inspired by &lt;code&gt;homebrew&lt;/code&gt;, I created a &lt;a href="https://github.com/nevillelyh/dotfiles/blob/master/.dotfiles/scripts/bootstrap-dotfiles.sh"&gt;bootstrap-dotfiles.sh&lt;/a&gt; that automates everything for me. The script is cross-platform and uses &lt;code&gt;aptitude&lt;/code&gt; on Debian or Ubuntu and &lt;code&gt;brew&lt;/code&gt; on Mac &lt;span class="caps"&gt;OS&lt;/span&gt; X for native packages. It also installs Python packages via &lt;code&gt;pip&lt;/code&gt;, vim plugins via Vundle, checks out the git repo into &lt;code&gt;HOME&lt;/code&gt; and changes the default shell to &lt;code&gt;zsh&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;summary&lt;/h2&gt;
&lt;p&gt;With this setup I can easily move into a new environment with all the tools and shortcuts configured exactly the same way. Nevertheless I still try to tweak it constantly, removing stuff I rarely use and adding new ones for things I found myself doing repeatedly. And that&amp;#8217;s the same advice I gave to people who borrow my dotfiles, add one thing at a time and tweak it to your liking. Hope you all figure out something that makes you most&amp;nbsp;productive.&lt;/p&gt;</content><category term="dotfiles"></category><category term="git"></category><category term="tmux"></category><category term="vim"></category><category term="xmonad"></category><category term="zsh"></category></entry><entry><title>First (real) post with Pelican</title><link href="https://www.lyh.me/first-real-post-with-pelican.html" rel="alternate"></link><published>2014-07-26T22:47:00-04:00</published><updated>2014-07-26T22:47:00-04:00</updated><author><name>Neville Li</name></author><id>tag:www.lyh.me,2014-07-26:/first-real-post-with-pelican.html</id><summary type="html">&lt;p&gt;Finally decided to jump (back) on the blogging bandwagon. This time I decided to use a static site generator, since that seems the cool thing to do these days, and found this &lt;a href="https://www.staticgen.com/"&gt;site&lt;/a&gt;. I want something in a language I know well, so Ruby or JavaScript is out. It should …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Finally decided to jump (back) on the blogging bandwagon. This time I decided to use a static site generator, since that seems the cool thing to do these days, and found this &lt;a href="https://www.staticgen.com/"&gt;site&lt;/a&gt;. I want something in a language I know well, so Ruby or JavaScript is out. It should also be actively maintained, so Scala is out since &lt;a href="https://github.com/wspringer/monkeyman"&gt;monkeyman&lt;/a&gt;, the only entry there, seems abandoned. I eventually settled on &lt;a href="http://blog.getpelican.com/"&gt;Pelican&lt;/a&gt;, the top ranked Python&amp;nbsp;framework.&lt;/p&gt;
&lt;p&gt;I set up a new &lt;a href="http://virtualenv.readthedocs.org/en/latest/"&gt;virtualenv&lt;/a&gt; with &lt;a href="http://virtualenvwrapper.readthedocs.org/en/latest/"&gt;virtualenvwrapper&lt;/a&gt; and also discovered &lt;a href="https://github.com/kennethreitz/autoenv"&gt;autoenv&lt;/a&gt; along the way. It was easy to get started with the &lt;code&gt;pelican-quickstart&lt;/code&gt; script and in a few minutes I have a working site already. Next I went shopping for themes in &lt;a href="https://github.com/getpelican/pelican-themes"&gt;pelican-themes&lt;/a&gt; and picked &lt;a href="https://github.com/DandyDev/pelican-bootstrap3.git"&gt;pelican-bootstrap3&lt;/a&gt;. Turns out it doesn&amp;#8217;t work with &lt;a href="https://www.spotify.com"&gt;Spotify&lt;/a&gt; icon yet so I forked the repo and made a quick &lt;a href="https://github.com/DandyDev/pelican-bootstrap3/pull/115"&gt;&lt;span class="caps"&gt;PR&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;After some further tweaking with the settings I was pretty happy with the results. I went on to set up &lt;a href="https://disqus.com/"&gt;Disqus&lt;/a&gt; and &lt;a href="http://www.google.com/analytics/"&gt;Google Analytics&lt;/a&gt; for the site, and published it to my &lt;a href="https://www.linode.com/"&gt;Linode&lt;/a&gt; with &lt;code&gt;make ssh_upload&lt;/code&gt;.&lt;/p&gt;</content><category term="pelican"></category><category term="python"></category><category term="virtualenv"></category></entry></feed>